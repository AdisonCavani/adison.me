---
import BaseSEO from "./Base.astro";
import { urlFor } from "@lib/Queries";
import type { AuthorSchema, TagSchema } from "@lib/Types";

type Props = {
  title: string;
  description: string;
  datePublished: string;
  dateModified: string;
  coverImage: string;
  authors: Array<AuthorSchema>;
  tags: Array<TagSchema>;
};

const {
  title,
  description,
  datePublished,
  dateModified,
  coverImage,
  authors,
  tags,
} = Astro.props;

const imageHref = urlFor(coverImage).width(1200).height(630).url();

const structuredData = {
  "@context": "https://schema.org",
  "@type": "Article",
  headline: title,
  author: [
    authors.map((author) => ({
      "@type": "Person",
      name: `${author.firstName} ${author.lastName}`,
      url: author.github,
      image: {
        "@type": "ImageObject",
        url: urlFor(author.image).width(256).height(256).url(),
        width: 256,
        height: 256,
      },
    })),
  ],
  datePublished: datePublished,
  dateModified: dateModified,
  description: description,
  image: {
    "@type": "ImageObject",
    url: imageHref,
    width: 1200,
    height: 630,
  },
};
---

<BaseSEO
  title={title}
  description={description}
  ogType="article"
  ogImage={imageHref}
  datePublished={datePublished}
  dateModified={dateModified}
  authors={authors}
  tags={tags}
  structuredData={JSON.stringify(structuredData)}
/>
